{% load i18n %}
<div id="wishlist-container"
     data-error-add-to-cart="{% trans 'Error adding to cart' %}">
  <div id="wishlist-modal" class="fixed right-0 top-0 h-screen w-full max-w-md bg-white shadow-2xl z-50 transition-transform duration-300">
    <div class="h-full flex flex-col">
      
      <!-- Header -->
      <div class="flex justify-between items-center p-6 border-b">
        <h1 class="text-2xl font-bold">
          {% trans "WISHLIST" %} (<span id="wishlist-count">{{ wishlist_count }}</span>)
        </h1>
        <button onclick="closeWishlistModal()" class="text-2xl hover:text-gray-600">Ã—</button>
      </div>

      <!-- Body -->
      <div class="flex-1 overflow-y-auto p-6">
        {% if items %}
          <div id="wishlist-items">
            {% include 'wishlist/wishlist_list.html' with items=items only %}
          </div>
        {% else %}
          <div class="h-full flex flex-col items-center justify-start text-center text-gray-500 pt-20 mt-10">
            <p class="mb-4 text-lg">{% trans "Your wishlist is empty" %}</p>
            <button onclick="closeWishlistModal()" class="text-sm underline">
                {% trans "Continue browsing" %}
            </button>
          </div>
        {% endif %}
      </div>

      <!-- Footer -->
      {% if items %}
      <div class="border-t p-6">
        <button 
            hx-post="{% url 'wishlist:clear' %}" 
            hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}' 
            hx-target="#wishlist-container"
            hx-swap="innerHTML"
            hx-on="htmx:afterSwap: updateWishlistCountManually"
            class="w-full block bg-black text-white py-3 px-6 text-sm font-medium text-center uppercase hover:bg-gray-800 transition-colors">
            {% trans "Clear Wishlist" %}
        </button>
      </div>
      {% endif %}

    </div>
  </div>

  <!-- Overlay -->
  <div id="wishlist-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 transition-all duration-300" onclick="closeWishlistModal()"></div>
</div>

<script>
function addWishlistItemToCart(productSlug, sizeId) {
    const formData = new FormData();
    formData.append('size_id', sizeId);
    formData.append('quantity', 1);

    const container = document.getElementById('wishlist-container');
    const TEXT_ERROR_ADD = container?.dataset.errorAddToCart || 'Error adding to cart';

    fetch(`/cart/add/${productSlug}/`, {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': getCookie('csrftoken')
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification(data.message);
            updateHeaderCartCount(data.total_items);
            htmx.ajax('GET', '/cart/', {
                target: '#cart-container',
                swap: 'innerHTML'
            });
        } else {
            showNotification(data.error || TEXT_ERROR_ADD);
        }
    })
    .catch(error => {
        console.error('Add to cart error:', error);
        showNotification(TEXT_ERROR_ADD);
    });
}
</script>
